# PyPvSimulator

## Meter
Meter produces power in Watts (W) from 0 to 9000W. This mocks a regular home power consumption.
#### Assumption: 
More than one house can send its meter power value if they are in a neighbourhood and hence i have used 3 houses HOUSE A, HOUSE B and HOUSE C which sends power values from its meter at the interval of 10 seconds to the Broker.

## PhotoVoltaic Simulator
PV simulator generates power in Watts (W) over a period of time. The result to be saved in a file with at least a timestamp, meter
power value, PV power value and the sum of the powers (meter + PV).
#### Assumption:
- PV simulator assumes to generate a power value between 0 to 4000W which is considered an avarage for a given solar panel. PV simulator is assumed to be located in a different location wrt Meter and hence will be receiving power values from multiple meters via broker and saves these values in a CSV file.
- For each Meter(house) a separate CSV file will be generated per day and the file will be rolled depending on the date for that Meter. This approach is used for the sake of documenting and analysing the power values generated by each Meter and thus can be retrieved based on the date. This approach can support more number of Meters/houses.

## Broker
Broker used here is RabbitMQ

## Requirements
##### 1. RabbitMQ using Docker(assuming docker is installed)
  - docker run -d --name some-rabbit -p 4369:4369 -p 5671:5671 -p 5672:5672 -p 15672:15672 rabbitmq:3-alpine
  - docker container exec -it some-rabbit rabbitmq-plugins enable rabbitmq_management
  
##### 2. Python >= 3.7 and aio-pika
  - pip install aio-pika
  
## How to run locally
#### Meter Module
```python
python pypvsimulator/meter/__main__.py
```
#### PV Simulator Module
```python
python pypvsimulator/pvsimulator/__main__.py
```

#### Output
The output can be viewed in the CSV file generated in csv_storage/ directory.

#### Logs
The logs are saved in the log/ directory. A rotate file handler log is used for both Meter and PV Simulator. Meter logs are named meter.log and PV Simulator logs are pv_simulator.log and this is due to the fact that Meter and PV simulator will be deployed at different location. Both Meter and PV Simulator module can create log/ directory automatically. The default log level is INFO.

## How to containerize and deploy for production
Both Meter and PV Simulator module has a Dockerfile and requirements file. A docker compose file can be created for Meter, PV simulator and RabbitMQ for the purpose of QA and Prod parallel performance testing.

```
cd pypvsimulator/meter/
docker build .
docker run <Image ID>

cd pypvsimulator/pvsimulator/
docker build .
docker run <Image ID>
```

## How to run tests
```
cd pypvsimulator/meter/
python -m unittest discover test

cd pypvsimulator/pvsimulator/
python -m unittest discover test
```
 
